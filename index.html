<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Unlocker</title>
    <style>
        body { background: #0b0b0b; color: #fff; font-family: sans-serif; text-align: center; padding: 15px; margin: 0; }
        .box { background: #1a1a1a; padding: 20px; border-radius: 15px; border: 2px solid #00ffa3; margin-top: 20px; }
        img, video { width: 100%; border-radius: 12px; filter: blur(15px); margin-top: 15px; transition: 1.5s; }
        .btn { background: #0084ff; color: #fff; border: none; padding: 15px; border-radius: 10px; cursor: pointer; width: 100%; margin-top: 15px; font-weight: bold; font-size: 18px; }
        
        /* TIMER OVERLAY (Vigyapan Parda) */
        #timerOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column;
            justify-content: center; align-items: center;
        }
        #countdownNumber { font-size: 100px; color: #00ffa3; font-weight: bold; }
        .msg { font-size: 18px; margin: 10px; color: #ccc; }
    </style>
</head>
<body>

<div id="timerOverlay">
    <div class="msg">Vigyapan Chal Raha Hai... Pratiksha Karein<br><i>Ad is loading... Please wait</i></div>
    <div id="countdownNumber">30</div>
    <div class="msg" style="color:#ff4d4d;">Timer khatam hote hi file khul jayegi<br><i>File will open after timer</i></div>
</div>

<div id="loginBox" class="box">
    <h3>Admin Login</h3>
    <input type="password" id="pass" placeholder="1234" style="padding:10px;">
    <button onclick="checkPass()">Login</button>
</div>

<div id="adminPanel" class="box" style="display:none;">
    <input type="file" id="fileInput"> 
    <button class="btn" onclick="uploadFile()">Generate Link</button>
    <div id="linkOutput" style="display:none; margin-top:10px; word-break:break-all;">
        <p id="finalURL" style="color:#00ffa3;"></p>
        <button onclick="copyLink()">Copy</button>
    </div>
</div>

<div id="userPanel" class="box" style="display:none;">
    <h3 id="statusHead" style="color: #ff4d4d;">ðŸ”’ FILE LOCKED</h3>
    <img id="p" style="display:none;"> 
    <video id="v" style="display:none;" playsinline loop muted></video>
    <button id="unBtn" class="btn" onclick="startProcess()">UNLOCK & VIEW FILE (30s)</button>
    
    <script type='text/javascript' src='//pl25732282.effectivegatecpm.com/6d/5a/e2/6d5ae25a8b0c2974cabf7d073c7cc9f8.js'></script>
</div>

<script>
    const CLOUD_NAME = "dn10tsupa"; 
    const UPLOAD_PRESET = "dn10tsupa"; 

    const urlParams = new URLSearchParams(window.location.search);
    const m = urlParams.get('m');

    if (m) {
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('userPanel').style.display = 'block';
        if (m.match(/\.(mp4|mov|webm)/i)) {
            const v = document.getElementById('v'); v.src = m; v.style.display = 'block';
        } else {
            const p = document.getElementById('p'); p.src = m; p.style.display = 'block';
        }
    }

    function checkPass() {
        if(document.getElementById('pass').value === "1234") {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
        }
    }

    async function uploadFile() {
        const file = document.getElementById('fileInput').files[0];
        if (!file) return;
        const btn = document.querySelector("#adminPanel .btn");
        btn.innerText = "Uploading...";
        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", UPLOAD_PRESET);
        const type = file.type.startsWith('video') ? 'video' : 'image';
        const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/${type}/upload`, { method: "POST", body: formData });
        const data = await res.json();
        if(data.secure_url) {
            document.getElementById('finalURL').innerText = window.location.origin + window.location.pathname + "?m=" + data.secure_url;
            document.getElementById('linkOutput').style.display = 'block';
        }
        btn.innerText = "Generate Link";
    }

    function startProcess() {
        // 1. Adsterra ad tab kholna
        window.open('ads.html', '_blank'); 

        // 2. Timer Parda dikhana
        const overlay = document.getElementById('timerOverlay');
        const countDisplay = document.getElementById('countdownNumber');
        overlay.style.display = 'flex';
        
        let seconds = 30;
        let timer = setInterval(() => {
            seconds--;
            countDisplay.innerText = seconds;
            
            if(seconds <= 0) {
                clearInterval(timer);
                // 3. TIMER HATANA AUR FILE DIKHANA
                overlay.style.display = 'none'; 
                
                const photo = document.getElementById('p');
                const video = document.getElementById('v');
                photo.style.filter = "blur(0px)";
                video.style.filter = "blur(0px)";
                
                if(video.src) { video.muted = false; video.play(); }
                
                document.getElementById('unBtn').style.display = 'none';
                document.getElementById('statusHead').innerText = "âœ… File Dekhein / View File";
                document.getElementById('statusHead').style.color = "#00ffa3";
            }
        }, 1000);
    }

    function copyLink() {
        navigator.clipboard.writeText(document.getElementById('finalURL').innerText);
        alert("Link Copied!");
    }
</script>
</body>
</html>
