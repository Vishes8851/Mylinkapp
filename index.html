<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard & Media Locker</title>
    <script type='text/javascript' src='//pl25732282.effectivegatecpm.com/6d/5a/e2/6d5ae25a8b0c2974cabf7d073c7cc9f8.js'></script>
    <style>
        body { background: #0b0b0b; color: #fff; font-family: sans-serif; text-align: center; padding: 15px; margin: 0; }
        .admin-box { background: #1a1a1a; padding: 20px; border-radius: 15px; border: 2px solid #00ffa3; margin-bottom: 30px; margin-top: 20px; }
        .user-box { background: #111; padding: 20px; border-radius: 15px; border: 1px solid #333; }
        img, video { width: 100%; border-radius: 12px; filter: blur(50px); transition: 1.5s; margin-top: 15px; display: none; }
        .btn { background: #0084ff; color: #fff; border: none; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; font-size: 16px; }
        #linkOutput { background: #000; padding: 15px; margin-top: 15px; word-break: break-all; color: #00ffa3; display: none; border-radius: 8px; font-size: 13px; border: 1px dashed #555; }
        input[type="file"] { margin: 15px 0; color: #ccc; }
    </style>
</head>
<body>

<div class="admin-box" id="adminPanel">
    <h3 style="color: #00ffa3; margin-top: 0;">üë®‚Äçüíª Admin Dashboard</h3>
    <p style="font-size: 13px; color: #aaa;">Gallery se Photo ya Video select karein:</p>
    
    <input type="file" id="fileInput" accept="image/*,video/*">
    <button class="btn" style="background: #00ffa3; color: #000;" onclick="uploadFile()">Upload & Create Earning Link</button>
    
    <div id="linkOutput">
        <p style="color: #fff; margin: 0 0 10px 0;">Aapka Monetized Link:</p>
        <p id="finalURL" style="background: #222; padding: 10px; border-radius: 5px;"></p>
        <button onclick="copyLink()" style="background:#fff; color:#000; border:none; padding:8px 15px; border-radius: 5px; cursor:pointer; font-weight: bold; margin-top: 10px;">Copy Link</button>
    </div>
</div>

<div class="user-box" id="userPanel" style="display:none;">
    <h3 id="head" style="color: #ff4d4d;">üîí FILE SECURED</h3>
    <p id="statusMsg" style="font-size: 14px; color: #ccc;">Unlock karne ke liye niche click karein</p>
    
    <img id="p"> 
    <video id="v" playsinline loop></video>
    
    <button id="unBtn" class="btn" onclick="startAds()">UNLOCK TO VIEW</button>
</div>

<script>
    // --- SETTINGS (Maine Aapki Details Daal Di Hain) ---
    const CLOUD_NAME = "dn10tsupa"; 
    const UPLOAD_PRESET = "dn10tsupa"; 

    const urlParams = new URLSearchParams(window.location.search);
    const m = urlParams.get('m');

    // 1. Agar link mein 'm' parameter hai (User Side)
    if (m) {
        document.getElementById('adminPanel').style.display = 'none';
        document.getElementById('userPanel').style.display = 'block';
        
        // Check if video or image
        if (m.match(/\.(mp4|mov|webm|m4v|ogv)/i) || m.includes("video/upload")) {
            const v = document.getElementById('v'); v.src = m; v.style.display = 'block';
        } else {
            const p = document.getElementById('p'); p.src = m; p.style.display = 'block';
        }
    }

    // 2. Admin Side: Gallery se Upload karne ke liye
    async function uploadFile() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];
        
        if (!file) {
            alert("Bhai, pehle gallery se koi file toh chuno!");
            return;
        }

        const btn = document.querySelector(".admin-box .btn");
        btn.innerText = "Uploading... Thoda sabar rakho";
        btn.disabled = true;

        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", UPLOAD_PRESET);

        try {
            // Determine if it's a video or image for Cloudinary API
            const resourceType = file.type.startsWith('video') ? 'video' : 'image';
            
            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/${resourceType}/upload`, { 
                method: "POST", 
                body: formData 
            });
            
            const data = await res.json();
            
            if(data.secure_url) {
                const eLink = window.location.origin + "/?m=" + data.secure_url;
                document.getElementById('finalURL').innerText = eLink;
                document.getElementById('linkOutput').style.display = 'block';
                alert("Mubarak ho! Link ban gaya.");
            } else {
                alert("Upload failed! Check if Preset is 'Unsigned'.");
            }
        } catch (err) {
            console.error(err);
            alert("Network Error! Phir se try karein.");
        } finally {
            btn.innerText = "Upload & Create Earning Link";
            btn.disabled = false;
        }
    }

    // 3. Unlock Logic (Ads + Blur Removal)
    function startAds() {
        window.open('ads.html', '_blank'); // Adsterra Link tab
        
        let t = 10;
        const b = document.getElementById('unBtn');
        b.disabled = true;
        
        let itv = setInterval(() => {
            t--; 
            b.innerText = `Unlocking in ${t}s...`;
            if(t <= 0){
                clearInterval(itv);
                document.getElementById('p').style.filter = "blur(0px)";
                document.getElementById('v').style.filter = "blur(0px)";
                if(document.getElementById('v').src) document.getElementById('v').play();
                
                b.style.display = 'none'; 
                document.getElementById('head').innerText = "üîì UNLOCKED";
                document.getElementById('head').style.color = "#00ffa3";
                document.getElementById('statusMsg').innerText = "Enjoy your media!";
            }
        }, 1000);
    }

    function copyLink() {
        const text = document.getElementById('finalURL').innerText;
        navigator.clipboard.writeText(text).then(() => {
            alert("Link Copy Ho Gaya! Ab ise share karein.");
        });
    }
</script>

</body>
</html>
